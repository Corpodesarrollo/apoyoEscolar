#VERSION	FECHA		AUTOR			DESCRIPCION
#    1.0	28/11/2019	JORGE CAMACHO	Se agregó la propiedad cambio.actualizarTablasTipoMeta


cambio.getLocalidades=select g_concodigo, '['||g_concodigo||'] '||g_connombre from g_constante where g_contipo=7 order by 1
cambio.getLocalidadesCambios=select g_concodigo, '['||g_concodigo||'] '||g_connombre from g_constante where g_contipo=7 and g_concodigo in(select distinct inscodlocal from institucion, poal_solicitarcambio where socacodentidad=inscodigo and socavigencia=? and socacodnivel=3) order by 1
#cambio.getLocalidadesCambios=SELECT G_CONCODIGO, '('||G_CONCODIGO||')'||G_CONNOMBRE FROM G_CONSTANTE WHERE G_CONTIPO=7 ORDER BY G_CONORDEN
#cambio.listaColegio=SELECT distinct INSCODIGO, INSNOMBRE,POACODIGO, POAESTADO FROM INSTITUCION,POA b, POAL_SOLICITARCAMBIO c WHERE INSCODLOCAL=? AND INSCODIGO=b.POACODINST AND b.POAVIGENCIA=? AND b.POAESTADO=1 AND b.POACODIGO IN (SELECT MAX(a.POACODIGO) FROM POA a WHERE a.POACODINST=b.POACODINST AND a.POAVIGENCIA=b.POAVIGENCIA) and c.SOCACODNIVEL=3 and c.SOCACODENTIDAD = b.POACODINST and SOCAVIGENCIA=b.POAVIGENCIA ORDER BY 2
cambio.listaColegio=SELECT DISTINCT(INSCODIGO), INSNOMBRE, POAESTADO FROM INSTITUCION I INNER JOIN POA P ON I.INSCODIGO = P.POACODINST WHERE P.POAVIGENCIA=? AND I.INSCODLOCAL=? AND P.POACODIGO = (SELECT MAX(POACODIGO) FROM POA P WHERE P.POACODINST = I.INSCODIGO AND P.POAVIGENCIA=?) ORDER BY INSNOMBRE

cambio.lista=SELECT SOCAVIGENCIA, SOCACODNIVEL, SOCACODENTIDAD, to_char(SOCAFECHASOL,'dd/mm/yyyy hh24:mi:ss'), to_char(SOCAFECHASOL,'dd/mm/yyyy-hh24:mi:ss'), SOCAESTADO, to_char(SOCAFECHAESTADO,'dd/mm/yyyy hh24:mi:ss'), SOCAASUNTO, SOCASOLICITUD, SOCAUSUARIOSOL, SOCAUSUARIOAPRO, SOCAOBSERVACION FROM POAL_SOLICITARCAMBIO WHERE SOCAVIGENCIA=? AND SOCACODNIVEL=? AND SOCACODENTIDAD=? order by SOCAFECHASOL desc
cambio.lista2=SELECT SOCAVIGENCIA, SOCACODNIVEL, SOCACODENTIDAD, to_char(SOCAFECHASOL,'dd/mm/yyyy hh24:mi:ss'), to_char(SOCAFECHASOL,'dd/mm/yyyy-hh24:mi:ss'), SOCAESTADO, to_char(SOCAFECHAESTADO,'dd/mm/yyyy hh24:mi:ss'), SOCAASUNTO, SOCASOLICITUD, SOCAUSUARIOSOL, SOCAUSUARIOAPRO, SOCAOBSERVACION FROM POAL_SOLICITARCAMBIO WHERE SOCAVIGENCIA=? AND SOCACODNIVEL=? AND SOCACODENTIDAD in (select poacodinst from poa P where POAVIGENCIA=? and poacodinst in (select I.INSCODIGO from institucion I where I.INSCODLOCAL = ?) and P.POAESTADO = 1) order by SOCAFECHASOL desc
cambio.lista3=SELECT SOCAVIGENCIA, SOCACODNIVEL, SOCACODENTIDAD, to_char(SOCAFECHASOL,'dd/mm/yyyy hh24:mi:ss'), to_char(SOCAFECHASOL,'dd/mm/yyyy-hh24:mi:ss'), SOCAESTADO, to_char(SOCAFECHAESTADO,'dd/mm/yyyy hh24:mi:ss'), SOCAASUNTO, SOCASOLICITUD, SOCAUSUARIOSOL, SOCAUSUARIOAPRO, SOCAOBSERVACION FROM POAL_SOLICITARCAMBIO WHERE SOCAVIGENCIA=? AND SOCACODNIVEL=? AND SOCACODENTIDAD IN (SELECT P.POACODINST FROM POA P WHERE POAVIGENCIA=? AND POACODINST=? AND P.POAESTADO = 1) ORDER BY SOCAFECHASOL DESC
cambio.obtener=SELECT SOCAVIGENCIA, SOCACODNIVEL, SOCACODENTIDAD, to_char(SOCAFECHASOL,'dd/mm/yyyy hh24:mi:ss'), SOCAESTADO, to_char(SOCAFECHAESTADO,'dd/mm/yyyy hh24:mi:ss'), SOCAASUNTO, SOCASOLICITUD, SOCAUSUARIOSOL, SOCAUSUARIOAPRO, SOCAOBSERVACION FROM POAL_SOLICITARCAMBIO where SOCAVIGENCIA=? and SOCACODNIVEL=? and SOCACODENTIDAD=? and to_date(?,'dd/mm/yyyy hh24:mi:ss')=SOCAFECHASOL

cambio.obtenerEstado=SELECT  SOCAESTADO FROM POAL_SOLICITARCAMBIO where SOCAVIGENCIA=? and SOCACODNIVEL=? and SOCACODENTIDAD=? and to_date(?,'dd/mm/yyyy hh24:mi:ss')=SOCAFECHASOL

cambio.ingresar=INSERT INTO POAL_SOLICITARCAMBIO (SOCAVIGENCIA, SOCACODNIVEL, SOCACODENTIDAD, SOCAFECHASOL, SOCAESTADO, SOCAFECHAESTADO, SOCAASUNTO, SOCASOLICITUD, SOCAUSUARIOSOL) VALUES ( ?,? ,? , sysdate, ?, sysdate, ?, ?, ?)
cambio.actualizar=UPDATE POAL_SOLICITARCAMBIO SET    SOCAESTADO      = ?, SOCAFECHAESTADO = sysdate, SOCAASUNTO      = ?, SOCASOLICITUD   = ?, SOCAUSUARIOSOL  = ? WHERE  SOCAVIGENCIA    = ? AND    SOCACODNIVEL    = ? AND    SOCACODENTIDAD  = ? AND    SOCAFECHASOL    = to_date(?,'dd/mm/yyyy hh24:mi:ss')
cambio.eliminar=delete from POAL_SOLICITARCAMBIO WHERE  SOCAVIGENCIA    = ? AND    SOCACODNIVEL    = ? AND    SOCACODENTIDAD  = ? AND    SOCAFECHASOL    = to_date(?,'dd/mm/yyyy hh24:mi:ss')

cambio.updateEstado=UPDATE POAL_SOLICITARCAMBIO SET    SOCAESTADO      = ?, SOCAFECHAESTADO = sysdate, SOCAUSUARIOAPRO = ?, socaobservacion=? WHERE  SOCAVIGENCIA    = ? AND    SOCACODNIVEL    = ? AND SOCAFECHASOL = to_date(?,'dd/mm/yyyy hh24:mi:ss')

cambio.listaVigencia=SELECT to_number(G_PARVIGPOA)-1,to_number(G_PARVIGPOA),to_number(G_PARVIGPOA)+1 FROM G_PARAMETRO
cambio.totalPonderado=SELECT SUM(PLACPONDERADO) FROM POA_PLANACTIVIDAD WHERE PLACVIGENCIA=? AND PLACCODINST=?
cambio.label=SELECT UPPER(column_name),REPLACE(REPLACE(comments,CHR(10),''),CHR(13),'') FROM USER_COL_COMMENTS WHERE table_name='POA_PLANACTIVIDAD'

cambio.validarEstado=SELECT POAESTADO FROM POA WHERE POAVIGENCIA=? AND POACODINST=? ORDER BY POACODIGO DESC
cambio.validarPonderadoActualizacion=SELECT SUM(PLACPONDERADO) FROM POA_PLANACTIVIDAD WHERE PLACVIGENCIA=? AND PLACCODINST=? AND PLACCODIGO<>?
cambio.getPonderadoArea=SELECT NVL(SUM(PLACPONDERADO),0) FROM POA_PLANACTIVIDAD WHERE PLACVIGENCIA=? AND PLACCODINST=? AND PLACCODIGO<>? AND PLACCODARGESTION=?

cambio.rangoFecha=SELECT TO_CHAR(PRF_INI_PLA,'dd/mm/yyyy'), TO_CHAR(PRF_FIN_PLA,'dd/mm/yyyy'), (CASE WHEN SYSDATE BETWEEN PRF_INI_PLA AND PRF_FIN_PLA THEN 1 ELSE 0 END) FROM POA_PRGFECHAS WHERE PRFVIGENCIA=?


poa.getEstado=SELECT POAESTADO,POAOBSERVACION,REPLACE(REPLACE(POAOBSERVACION,CHR(10),'.'),CHR(13),'.') FROM POA WHERE POAVIGENCIA=? AND POACODINST=? ORDER BY POACODIGO DESC
poa.getEstado2=select * from poa where POAVIGENCIA=? and poacodinst in (select I.INSCODIGO from institucion I where I.INSCODLOCAL =?);
poa.codigo=SELECT NVL(MAX(POACODIGO),0)+1 FROM POA WHERE POAVIGENCIA=? AND POACODINST=?
poa.ingresar=INSERT INTO POA (POAVIGENCIA, POACODINST, POACODIGO,POAESTADO, POAFECHAESTADO, POAESTAPA,POAOBSERVACION)VALUES (?,?,?,?,SYSDATE,?,?)
poa.actualizar=UPDATE POA SET POAESTADO=?, POAFECHAESTADO=SYSDATE, POAESTAPA=?, POAOBSERVACION=? WHERE POAVIGENCIA=? AND POACODINST=? AND POACODIGO=?
poa.validarPonderado=SELECT SUM(PLACPONDERADO) FROM POA_PLANACTIVIDAD WHERE PLACVIGENCIA=? AND PLACCODINST=?

poa.updateVersion=update POA set POAESTAPA = POAESTAPA +1 where POACODINST =? and POAVIGENCIA=? and POAESTADO = 1






####

planeacion.listaUnidadMedida=SELECT UNMECODIGO, UNMENOMBRE,UNMECUAL FROM POA_UNIMEDIDA order by UNMEORDEN
planeacion.listaAreaGestion=SELECT ARGECODIGO, ARGENOMBRE,ARGEPONDERADOR FROM POA_AREAGESTION order by ARGEORDEN
planeacion.listaTipoMeta=SELECT TIMECODIGO, TIMENOMBRE FROM POA_TIPOMETA order by TIMEORDEN
planeacion.listaLineaAccion=SELECT LIACCODIGO, LIACNOMBRE FROM POA_LINEAACCION where LIACCODAREAGESTION=? order by LIACORDEN
planeacion.getlistaObjetivos = SELECT  OBJCODIGO, OBJNOMBRE FROM POA_OBJETIVO where OBJESTADO = 1 order by ORDEN

poa.getNombreColegio=SELECT INSNOMBRE FROM INSTITUCION WHERE INSCODIGO=?

planeacion.lista2=SELECT DISTINCT PLACVIGENCIA, PLACCODINST, PLACCODIGO, substr(PLACOBJETIVO,0,100), substr(PLACNOMBRE,0,100), ARGENOMBRE, LIACNOMBRE,PLACPONDERADO , PLACCODOBJETIVO,OBJNOMBRE   FROM POA_PLANACTIVIDAD left outer join POA_AREAGESTION on (ARGECODIGO=PLACCODARGESTION) left outer join POA_LINEAACCION on (LIACCODIGO=PLACCODLIACCION) left outer join  POA_OBJETIVO ON  OBJCODIGO = PLACCODOBJETIVO   where PLACCODINST=? and PLACVIGENCIA=? order by PLACCODIGO
planeacion.obtener2=SELECT PLACVIGENCIA, PLACCODINST, PLACCODIGO, PLACORDEN, PLACOBJETIVO, PLACNOMBRE,  PLACCODARGESTION, PLACPONDERADO, PLACCODLIACCION,PLACCODTIMETA, PLACCANTIDAD, PLACCODUNMEDIDA, PLACOTROCUAL, PLACPRESUPUESTO, PLACNOMBRERESPON, to_char(PLACFECHATERMIN,'dd/mm/yyyy'), PLACPERIODO1, PLACPERIODO2, PLACPERIODO3, PLACPERIODO4  , PLACCODOBJETIVO,OBJNOMBRE , ACCIONMEJORAMIENTO, TIPOGASTO, RUBROGASTO,  SUBNIVELGASTO, FUENTEFINANCIACION, FUENTEFINANCIACIONOTROS, MONTOANUAL, PPTOPARTICIPATIVO, TIPOACTIVIDAD, TO_CHAR(SEGFECHACUMPLIMT,'dd/mm/yyyy'), TO_CHAR(SEGFECHAREALCUMPLIM,'dd/mm/yyyy'), PRESUPUESTOEJECUTADO, PLACOTROCUAL   FROM POA_PLANACTIVIDAD left outer join  POA_OBJETIVO ON  OBJCODIGO = PLACCODOBJETIVO  where PLACVIGENCIA=? and PLACCODINST=? and PLACCODIGO=?

planeacion.actualizar2=UPDATE POA_PLANACTIVIDAD SET SEGFECHACUMPLIMT=TO_DATE(?,'dd/mm/yyyy'), SEGFECHAREALCUMPLIM=TO_DATE(?,'dd/mm/yyyy'), PRESUPUESTOEJECUTADO=?, PLACORDEN=?, PLACOBJETIVO=?, PLACNOMBRE=?, PLACCODARGESTION=?, PLACPONDERADO=?, PLACCODLIACCION=?, PLACCODTIMETA=?, PLACCANTIDAD=?, PLACCODUNMEDIDA=?, PLACOTROCUAL=?, PLACPRESUPUESTO=?, PLACNOMBRERESPON=?, PLACFECHATERMIN=to_date(?,'dd/mm/yyyy'), PLACPERIODO1=?, PLACPERIODO2=?, PLACPERIODO3=?, PLACPERIODO4=?, PLACCODOBJETIVO = ? WHERE PLACVIGENCIA=? AND PLACCODINST=? AND PLACCODIGO=?
planeacion.actualizar=UPDATE POA_PLANACTIVIDAD SET SEGFECHACUMPLIMT=TO_DATE(?,'dd/mm/yyyy'), SEGFECHAREALCUMPLIM=TO_DATE(?,'dd/mm/yyyy'), PRESUPUESTOEJECUTADO=?, PLACORDEN=?, PLACOBJETIVO=?, PLACNOMBRE=?, PLACCODARGESTION=?, PLACPONDERADO=?, PLACCODLIACCION=?, PLACCODTIMETA=?, PLACCANTIDAD=?, PLACCODUNMEDIDA=?, PLACOTROCUAL=?, PLACPRESUPUESTO=?, PLACNOMBRERESPON=?, PLACFECHATERMIN=to_date(?,'dd/mm/yyyy'), PLACPERIODO1=?, PLACPERIODO2=?, PLACPERIODO3=?, PLACPERIODO4=?, PLACCODOBJETIVO = ?, ACCIONMEJORAMIENTO = ?, TIPOGASTO = ?, RUBROGASTO = ?,  SUBNIVELGASTO = ?, FUENTEFINANCIACION = ?, FUENTEFINANCIACIONOTROS = ?, MONTOANUAL = ?, PPTOPARTICIPATIVO = ?, TIPOACTIVIDAD = ?, FECHA_APROB_CAMBIOS=sysdate, USUARIO_APROB_CAMBIOS=?  WHERE PLACVIGENCIA=? AND PLACCODINST=? AND PLACCODIGO=?
planeacion.validarPonderadoActualizacion=SELECT SUM(PLACPONDERADO) FROM POA_PLANACTIVIDAD WHERE PLACVIGENCIA=? AND PLACCODINST=? AND PLACCODIGO<>?



planeacionSin.lista2=SELECT PLACVIGENCIA, PLACCODINST, PLACCODIGO, SUBSTR(PLACOBJETIVO,0,100), SUBSTR(PLACNOMBRE,0,100), ARGENOMBRE, LIACNOMBRE , PLACCODOBJETIVO,OBJNOMBRE    FROM  POA_PLANACTIVIDAD2 left outer join POA_AREAGESTION ON (ARGECODIGO=PLACCODARGESTION) left outer join POA_LINEAACCION ON (LIACCODIGO=PLACCODLIACCION) left outer join  POA_OBJETIVO ON  OBJCODIGO = PLACCODOBJETIVO    WHERE PLACCODINST=? AND PLACVIGENCIA=?  ORDER BY PLACCODIGO
planeacionSin.obtener2=SELECT PLACVIGENCIA, PLACCODINST, PLACCODIGO, PLACORDEN, PLACOBJETIVO, PLACNOMBRE, PLACCODARGESTION, PLACCODLIACCION, PLACCANTIDAD, PLACCODUNMEDIDA, PLACOTROCUAL,PLACPRESUPUESTO , PLACCODOBJETIVO,OBJNOMBRE  FROM POA_PLANACTIVIDAD2 left outer join  POA_OBJETIVO ON  OBJCODIGO = PLACCODOBJETIVO    WHERE PLACVIGENCIA=? AND PLACCODINST=? AND PLACCODIGO=?

planeacionSin.actualizar=UPDATE POA_PLANACTIVIDAD2 SET PLACORDEN=?, PLACOBJETIVO=?, PLACNOMBRE=?, PLACCODARGESTION=?, PLACCODLIACCION=?, PLACCANTIDAD=?, PLACCODUNMEDIDA=?, PLACOTROCUAL=?,PLACPRESUPUESTO=?, placcodobjetivo = ? WHERE PLACVIGENCIA=? AND PLACCODINST=? AND PLACCODIGO=?

cambio.actualizarTablasTipoMeta=UPDATE POA_PLANACTIVIDAD SET SEGPORCDEMANDAP1=NULL, SEGPORCDEMANDAP2=NULL, SEGPORCDEMANDAP3=NULL, SEGPORCDEMANDAP4=NULL WHERE PLACVIGENCIA=? AND PLACCODINST=? AND PLACCODIGO=?
